# CVE, CPE, and CPEMatch Ontology v1.0 — Field-by-Field Mapping

This document summarizes the mapping between NVD CVE/CPE JSON fields and the KGCS ontology for CVE, CPE, and CPEMatch (matchingCriteria), as required for ETL emission and SHACL validation.

## Core Entity Types
- **Vulnerability** (CVE)
- **Platform** (CPE)
- **PlatformConfiguration** (CPEMatch)
- **VulnerabilityScore** (CVSS)

## Field-by-Field Mapping: CVE
| CVE Field / Property                | Ontology Property / Node         | Notes |
|-------------------------------------|-----------------------------------|-------|
| cve.CVE_data_meta.ID                | cveId                             | Always present; CVE-YYYY-NNNN |
| cve.description.description_data[].value | dct:description                   | |
| publishedDate                       | dct:created                       | Timestamp |
| lastModifiedDate                    | dct:modified                      | Timestamp |
| configurations.nodes[].cpe_match[]  | kgcs:affects (→ PlatformConfiguration) | See CPEMatch below |
| impact.baseMetricV3.cvssV3.*        | kgcs:cvssV3Score                   | CVSS v3.1 fields |
| impact.baseMetricV2.cvssV2.*        | kgcs:cvssV2Score                   | CVSS v2 fields |
| references.reference_data[].url     | kgcs:reference                     | List |
| sourceIdentifier                    | kgcs:source                        | |
| vulnStatus                          | kgcs:vulnStatus                    | |
| weaknesses[].description[]          | kgcs:causedBy (→ CWE)              | |
| cisaVulnerabilityName               | kgcs:cisaName                      | |
| cisaExploitAdd                      | kgcs:cisaExploitAdd                | |
| cisaActionDue                       | kgcs:cisaActionDue                 | |
| cisaRequiredAction                  | kgcs:cisaRequiredAction            | |
| cisaKnownRansomwareCampaignUse      | kgcs:cisaKnownRansomwareCampaignUse| |

## Field-by-Field Mapping: CPE
| CPE Field / Property                | Ontology Property / Node         | Notes |
|-------------------------------------|-----------------------------------|-------|
| cpe23Uri                            | cpeUri                             | Always present; cpe:2.3:* format |
| deprecated                          | kgcs:deprecated                    | Boolean |
| titles[].title                      | rdfs:label                         | |
| references[]                        | kgcs:reference                     | List |
| cpe_name_id                         | kgcs:cpeNameId                     | |
| part, vendor, product, version, update, edition, language, sw_edition, target_sw, target_hw, other | kgcs:part, kgcs:vendor, ... | All CPE attributes |

## Field-by-Field Mapping: CPEMatch (PlatformConfiguration)
| CPEMatch Field / Property           | Ontology Property / Node         | Notes |
|-------------------------------------|-----------------------------------|-------|
| cpe23Uri                            | kgcs:includes (→ Platform)         | |
| vulnerable                          | kgcs:vulnerable                    | Boolean |
| versionStartIncluding               | kgcs:versionStartIncluding         | |
| versionStartExcluding               | kgcs:versionStartExcluding         | |
| versionEndIncluding                 | kgcs:versionEndIncluding           | |
| versionEndExcluding                 | kgcs:versionEndExcluding           | |
| criteria                            | kgcs:criteria                      | Logical expression |
| matchCriteriaId                     | kgcs:matchCriteriaId               | |
| cpe_name_id                         | kgcs:cpeNameId                     | |

## Relationships
| Source Node         | Ontology Edge         | Target Node         | Notes |
|---------------------|----------------------|---------------------|-------|
| Vulnerability (CVE) | kgcs:affects         | PlatformConfiguration (CPEMatch) | CVE affects a specific configuration |
| PlatformConfiguration | kgcs:includes       | Platform (CPE)      | CPEMatch includes a CPE (atomic platform) |
| Vulnerability (CVE) | kgcs:causedBy        | Weakness (CWE)      | |
| Platform            | kgcs:deprecates      | Platform            | Obsolescence tracking |

## Node Types and IDs
- **Vulnerability**: CVE entry, cveId = CVE-YYYY-NNNN
- **Platform**: CPE entry, cpeUri = cpe:2.3:*
- **PlatformConfiguration**: CPEMatch, matchCriteriaId or hash
- **VulnerabilityScore**: CVSS v2/v3/v4 node

## Required for ETL Emission
- All above fields and relationships must be emitted as RDF triples
- All IDs must be preserved (cveId, cpeUri, matchCriteriaId, etc.)
- Relationships must use correct ontology edge (see above)
- PlatformConfiguration (CPEMatch) must capture version bounds, criteria, and vulnerable flag
- Deprecated/obsolescence must be handled

## Example: CVE Node
- cveId: CVE-2025-1234
- dct:description: "Improper input validation..."
- dct:created: "2025-01-01T00:00:00Z"
- kgcs:affects: PlatformConfiguration-abc123
- kgcs:causedBy: CWE-94
- kgcs:cvssV3Score: {...}
- kgcs:reference: ["https://nvd.nist.gov/vuln/detail/CVE-2025-1234"]

## Example: PlatformConfiguration Node
- matchCriteriaId: abc123
- kgcs:includes: cpe:2.3:a:microsoft:office:2016:*
- kgcs:vulnerable: true
- kgcs:versionStartIncluding: "2016"
- kgcs:versionEndExcluding: "2019"
- kgcs:criteria: "cpe:2.3:a:microsoft:office:2016:* AND ..."

---

This mapping should be used to audit and patch src/etl/etl_cve.py, src/etl/etl_cpe.py, and src/etl/etl_cpematch.py for full ontology conformance.
