# CVE, CPE, and CPEMatch Ontology v1.0 — Field-by-Field Mapping

This document summarizes the mapping between NVD CVE/CPE JSON fields and the KGCS ontology for CVE, CPE, and CPEMatch (matchingCriteria), as required for ETL emission and SHACL validation.

## Core Entity Types

- **Vulnerability** (CVE)
- **Platform** (CPE)
- **PlatformConfiguration** (CPEMatch)
- **VulnerabilityScore** (CVSS)

## Field-by-Field Mapping: CVE

| CVE Field / Property | Ontology Property / Node | Notes |
| ----------------------------------- | -------------------------------- | ----- |
| cve.CVE_data_meta.ID | cveId | Always present; CVE-YYYY-NNNN |
| cve.description.description_data[].value | dct:description | |
| publishedDate | dct:created | Timestamp |
| lastModifiedDate | dct:modified | Timestamp |
| configurations.nodes[].cpe_match[] | kgcs:affects (→ PlatformConfiguration) | See CPEMatch below |
| impact.baseMetricV3.cvssV3.* | kgcs:cvssV3Score | CVSS v3.1 fields |
| impact.baseMetricV2.cvssV2.* | kgcs:cvssV2Score | CVSS v2 fields |
| references.reference_data[].url | kgcs:reference | List |
| sourceIdentifier | kgcs:source | |
| vulnStatus | kgcs:vulnStatus | |
| weaknesses[].description[] | kgcs:causedBy (→ CWE) | |
| cisaVulnerabilityName | kgcs:cisaName | |
| cisaExploitAdd | kgcs:cisaExploitAdd | |
| cisaActionDue | kgcs:cisaActionDue | |
| cisaRequiredAction | kgcs:cisaRequiredAction | |
| cisaKnownRansomwareCampaignUse | kgcs:cisaKnownRansomwareCampaignUse | |

## Field-by-Field Mapping: CPE

| CPE Field / Property | Ontology Property / Node | Notes |
| --- | --- | --- |
| cpe23Uri | cpeUri | Always present; cpe:2.3:* format |
| deprecated | kgcs:deprecated | Boolean |
| titles[].title | rdfs:label | |
| references[] | kgcs:reference | List |
| cpe_name_id | kgcs:cpeNameId | |
| part, vendor, product, version, update, edition, language, sw_edition, target_sw, target_hw, other | kgcs:part, kgcs:vendor, ... | All CPE attributes |

## Field-by-Field Mapping: CPEMatch (PlatformConfiguration)

| CPEMatch Field / Property           | Ontology Property / Node         | Notes              |
|-------------------------------------|----------------------------------|--------------------|
| cpe23Uri                            | kgcs:includes (→ Platform)       |                    |
| vulnerable                          | kgcs:vulnerable                  | Boolean            |
| versionStartIncluding               | kgcs:versionStartIncluding       |                    |
| versionStartExcluding               | kgcs:versionStartExcluding       |                    |
| versionEndIncluding                 | kgcs:versionEndIncluding         |                    |
| versionEndExcluding                 | kgcs:versionEndExcluding         |                    |
| criteria                            | kgcs:criteria                    | Logical expression |
| matchCriteriaId                     | kgcs:matchCriteriaId             |                    |
| cpe_name_id                         | kgcs:cpeNameId                   |                    |

## Relationships

| Source Node | Ontology Edge | Target Node | Notes |
| --- | --- | --- | --- |
| Vulnerability (CVE) | kgcs:affects | PlatformConfiguration (CPEMatch) | CVE affects a specific configuration |
| PlatformConfiguration | kgcs:includes | Platform (CPE) | CPEMatch includes a CPE (atomic platform) |
| Vulnerability (CVE) | kgcs:causedBy | Weakness (CWE) | |
| Platform | kgcs:deprecates | Platform | Obsolescence tracking |

## Node Types and IDs

- **Vulnerability**: CVE entry, cveId = CVE-YYYY-NNNN
- **Platform**: CPE entry, cpeUri = cpe:2.3:*
- **PlatformConfiguration**: CPEMatch, matchCriteriaId or hash
- **VulnerabilityScore**: CVSS v2/v3/v4 node

## Required for ETL Emission

- All above fields and relationships must be emitted as RDF triples
- All IDs must be preserved (cveId, cpeUri, matchCriteriaId, etc.)
- Relationships must use correct ontology edge (see above)
- PlatformConfiguration (CPEMatch) must capture version bounds, criteria, and vulnerable flag
- Deprecated/obsolescence must be handled

## Example: CVE Node

- cveId: CVE-2025-1234
- dct:description: "Improper input validation..."
- dct:created: "2025-01-01T00:00:00Z"
- kgcs:affects: PlatformConfiguration-abc123
- kgcs:causedBy: CWE-94
- kgcs:cvssV3Score: {...}
- kgcs:reference: ["https://nvd.nist.gov/vuln/detail/CVE-2025-1234"]

## Example: PlatformConfiguration Node

- matchCriteriaId: abc123
- kgcs:includes: cpe:2.3:a:microsoft:office:2016:*
- kgcs:vulnerable: true
- kgcs:versionStartIncluding: "2016"
- kgcs:versionEndExcluding: "2019"
- kgcs:criteria: "cpe:2.3:a:microsoft:office:2016:* AND ..."

---

## SHACL — High Level

```turtle
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix cve: <http://example.org/cve#> .
@prefix cpe: <http://example.org/cpe#> .
@prefix cpematch: <http://example.org/cpematch#> .

cve:VulnerabilityShape a sh:NodeShape ;
 sh:targetClass cve:Vulnerability ;
 sh:property [ sh:path cve:affects ; sh:class cpematch:PlatformConfiguration ] ;
 sh:property [ sh:path cve:causedBy ; sh:class cwe:Weakness ] .

cpematch:PlatformConfigurationShape a sh:NodeShape ;
 sh:targetClass cpematch:PlatformConfiguration ;
 sh:property [ sh:path cpematch:includes ; sh:class cpe:Platform ] .
```

## Example Instances

```turtle
# CVE example
cve:CVE-2025-1234 a cve:Vulnerability ;
 dct:description "Example vulnerability" ;
 cve:affects cpematch:match-abc123 ;
 cve:causedBy cwe:CWE-94 .

# PlatformConfiguration example
cpematch:match-abc123 a cpematch:PlatformConfiguration ;
 cpematch:includes cpe:cpe23:a:microsoft:office:2016:* ;
 cpematch:vulnerable true ;
 cpematch:versionStartIncluding "2016" .
```

## References

- <https://nvd.nist.gov/>
- <https://cpe.mitre.org/>
- <https://cve.mitre.org/>

---

## Sources

- **NVD CVE API (CVE):** <https://nvd.nist.gov/products/cve-api-20>
- **NVD CVE JSON schema:** <https://csrc.nist.gov/schema/nvd/api/2.0/cve_api_json_2.0.schema>
- **NVD CPE (chunks zipped):** <https://nvd.nist.gov/feeds/json/cpe/2.0/nvdcpe-2.0.zip>
- **NVD CPE JSON schema:** <https://csrc.nist.gov/schema/nvd/api/2.0/cpe_api_json_2.0.schema>
- **NVD CPEmatch (chunks zipped):** <https://nvd.nist.gov/feeds/json/cpematch/2.0/nvdcpematch-2.0.zip>
- **NVD CPEmatch JSON schema:** <https://csrc.nist.gov/schema/nvd/api/2.0/cpematch_api_json_2.0.schema>
- **SHACL shapes:** [cve-shapes.ttl](../shacl/cve-shapes.ttl), [cpe-shapes.ttl](../shacl/cpe-shapes.ttl), [cpematch-shapes.ttl](../shacl/cpematch-shapes.ttl)
- **ETL transformers:** [etl_cve.py](../../scripts/etl_cve.py), [etl_cpe.py](../../scripts/etl_cpe.py)
 
- **Local schemas / samples:** `data/cve/schemas/` (e.g. `cve_api_json_2.0.schema`), `data/cve/raw/`, `data/cve/samples/`; `data/cpe/schemas/`, `data/cpe/raw/`, `data/cpe/samples/`

>Notes: Snapshots should include the API query parameters and feed timestamps in the `.meta.json` for reproducibility
---

This mapping should be used to audit and patch src/etl/etl_cve.py, src/etl/etl_cpe.py, and src/etl/etl_cpematch.py for full ontology conformance.
